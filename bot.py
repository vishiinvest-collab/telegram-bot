def _strip_sensitive(text: str) -> str:
    # На всякий случай убираем любые "проценты" из текста, если вдруг врач их впишет
    # (у тебя правило: проценты ингредиентов не публиковать)
    return re.sub(r"\b\d{1,3}\s*%\b", "[%]", text)

def build_gpt_prompt(draft: str, doctor_name: str) -> str:
    draft = _strip_sensitive(draft)

    return f"""
Ты — медицинский редактор бренда AV FITO (Detox System by Doc. Victor Bondarenco).
Задача: сделать из черновика врача чистый, структурированный, клиентоориентированный текст.

Вход: черновик рекомендаций врача.
Выход: финальная версия для клиента.

Жёсткие правила:
- НЕ упоминать, что это сгенерировано ИИ.
- НЕ добавлять выдуманные диагнозы/анализы/лекарства.
- НЕ добавлять дозировки/назначения рецептурных препаратов.
- НЕ указывать процентное соотношение ингредиентов (если встречается — убери).
- Язык: русский, тёплый профессиональный тон.
- Формат: заголовок + пункты + короткие абзацы, без воды.
- В конце подпись бренда.

Структура:
1) Заголовок: «Рекомендации доктора {doctor_name}»
2) Краткое резюме (1–3 предложения)
3) Блок «Что делаем сейчас» (список)
4) Блок «На что обратить внимание» (список)
5) Мягкий дисклеймер: «Если симптомы усиливаются — обратитесь к врачу/вызовите скорую при острых состояниях»
6) Подпись: «— AV FITO · Doc. Victor Bondarenco»

Черновик врача:
---
{draft}
---
""".strip()