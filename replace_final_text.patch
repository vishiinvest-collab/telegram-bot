*** Begin Patch
*** Update File: bot.py
@@
-        final_text = (
-            f"Рекомендации доктора {doctor_name}\n\n"
-            f"{draft_text}\n\n"
-            "— AV FITO · Doc. Victor Bondarenco"
-        )
-
-        await context.bot.send_message(chat_id=query.message.chat_id, text=final_text)
-        await query.edit_message_text("Готово ✅ Финальный текст отправлен отдельным сообщением.")
+        if not _oai_client:
+            await query.edit_message_text("Ошибка: не задан OPENAI_API_KEY в окружении.")
+            return
+
+        prompt = build_gpt_prompt(draft_text, doctor_name)
+
+        try:
+            resp = _oai_client.responses.create(
+                model=OPENAI_MODEL,
+                input=prompt,
+                max_output_tokens=900,
+            )
+            # В SDK есть удобное поле output_text
+            final_text = (resp.output_text or "").strip()
+            if not final_text:
+                raise RuntimeError("Empty model output")
+        except Exception:
+            logging.exception("OpenAI request failed")
+            await query.edit_message_text("Ошибка генерации. Попробуйте ещё раз через минуту.")
+            return
+
+        await context.bot.send_message(chat_id=query.message.chat_id, text=final_text)
+        await query.edit_message_text("Готово ✅ Финальный текст отправлен отдельным сообщением.")
*** End Patch
